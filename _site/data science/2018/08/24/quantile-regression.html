<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.2.0
    Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Quantile Regression | Matthew’s Blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Quantile Regression" />
<meta name="author" content="Matthew Burke" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Interpretable Linear Modeling" />
<meta property="og:description" content="Interpretable Linear Modeling" />
<link rel="canonical" href="https://mwburke.github.io/data%20science/2018/08/24/quantile-regression.html" />
<meta property="og:url" content="https://mwburke.github.io/data%20science/2018/08/24/quantile-regression.html" />
<meta property="og:site_name" content="Matthew’s Blog" />
<meta property="og:image" content="https://mwburke.github.io/images/placeholder.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-24T00:00:00-07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://mwburke.github.io/images/placeholder.png" />
<meta property="twitter:title" content="Quantile Regression" />
<meta name="twitter:site" content="@yot_club" />
<meta name="twitter:creator" content="@mattburkeley" />
<script type="application/ld+json">
{"description":"Interpretable Linear Modeling","author":{"@type":"Person","name":"Matthew Burke"},"@type":"BlogPosting","url":"https://mwburke.github.io/data%20science/2018/08/24/quantile-regression.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://mwburke.github.io/images/generative-art-31.png"},"name":"Matthew Burke"},"image":{"thumbnail":"/images/quantile_slope_values.png","url":"https://mwburke.github.io/images/placeholder.png","@type":"imageObject"},"headline":"Quantile Regression","dateModified":"2018-08-24T00:00:00-07:00","datePublished":"2018-08-24T00:00:00-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mwburke.github.io/data%20science/2018/08/24/quantile-regression.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/skins/light.css">
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i|Lora:400,400i,700,700i">
  <link rel="alternate" type="application/atom+xml" title="Matthew&#39;s Blog" href="/atom.xml">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#31ac94">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#31ac94">

</head>


  <body class="layout--post  quantile-regression">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/posts/">Posts</a></li><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li><li><a href="/search/">Search</a></li><li><a href="/about">About</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
      <a href="/" class="site-logo" rel="home" title="Matthew's Blog">
        <img src="/images/generative-art-31.png" class="site-logo-img animated fadeInDown" alt="Matthew's Blog">
      </a>
    
    
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    
  
  
  

  <div class="page-image">
    <img src="/images/placeholder.png" class="entry-feature-image u-photo" alt="Quantile Regression" >
    
  </div>


    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">Quantile Regression
</h1>
        
      </header>

      <div class="page-sidebar">
        <div class="page-author h-card p-author"><img src="/images/matthew-burke-photo.jpg" class="author-avatar u-photo" alt="Matthew Burke"><div class="author-info"><div class="author-name">
        <span class="p-name">Matthew Burke</span>
      </div><ul class="author-links"><li class="author-link">
            <a class="u-url" rel="me" href="https://twitter.com/yot_club"><i class="fab fa-twitter-square fa-lg" title="Twitter"></i></a>
          </li><li class="author-link">
            <a class="u-url" rel="me" href="https://instagram.com/yot_club_"><i class="fab fa-instagram fa-lg" title="Instagram"></i></a>
          </li><li class="author-link">
            <a class="u-url" rel="me" href="https://github.com/mwburke"><i class="fab fa-github-square fa-lg" title="GitHub"></i></a>
          </li></ul>

<span class="read-time">3 min read</span>

    <time class="page-date dt-published" datetime="2018-08-24T00:00:00-07:00"><a class="u-url" href="">August 24, 2018</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy"><a class="p-category" href="/categories/#data-science" title="Pages filed under Data Science">Data Science</a></li>
  </ul>


        
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy"><a href="/tags/#python" title="Pages tagged python" rel="tag">python</a></li><li class="page-taxonomy"><a href="/tags/#ml" title="Pages tagged ml" rel="tag">ml</a></li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <h1 id="black-box-machine-learning">Black Box Machine Learning</h1>

<p>The trend in machine learning these days seems to be heading more and more towards deep learning and extensive tree-based ensemble algorithms, which in turn results in a lot of models becoming <a href="https://en.wikipedia.org/wiki/Black_box">black box</a> algorithms, which nobody can fully explain. In the past, researchers were forced to use more simple, explainable techniques due to lack of compute power, but now with the advent of cloud computing and the ability to spin up clusters of high-powered CPUs and GPUs, those limitations have been removed and people have to trust that their cross-validation ensures applicability to unseen data.</p>

<p>My current job places a lot of emphasis on interpretability of models that get put into production, eliminating that inherent need to rely on algorithms or using methods to explain local behavior of models at specific points such as <a href="https://arxiv.org/pdf/1602.04938.pdf">LIME</a>. This has caused me to approach problem solving in a different way and look for methods that tow the line between performance and interpretability.</p>

<h1 id="quantile-regression">Quantile Regression</h1>

<p><a href="https://en.wikipedia.org/wiki/Quantile_regression">Quantile regression</a> is one of those techniques my colleagues and I have looked into that fulfills these requirements by fitting multiple linear regressions locally at different quantile points in the data.</p>

<p>This method captures the non-linear relationships between the covariates and the response variable close to each quantile while still having linear coefficients that are easily understandable from a human researcher for any given point. This has the potential to increase model performance drastically, especially for problems that have normally distributed response variables, where linear models tend to perform poorly outside of the mean.</p>

<h1 id="housing-example">Housing Example</h1>

<p>I used the <a href="https://www.kaggle.com/c/boston-housing">Boston housing dataset</a> to do a quick benchmark of standard linear regression versus quantile regression based on its non-uniform distribution of the median house price (target variable):</p>

<p><img src="/images/quantile_target_distribution.png" alt="" /></p>

<p>It appears as if there is a normal distribution with some outliers at the high end that may cap the median house value at 50.</p>

<p>I trained a standard OLS model on the data as well as a quantile regression model made up of individual regressions performed locally at each 0.05 quantile from 0 to 1 and compared the accuracy results below:</p>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Base Regression</th>
      <th>Quantile Regression</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>MAE</td>
      <td>3.271</td>
      <td>2.95</td>
    </tr>
    <tr>
      <td>MSE</td>
      <td>21.895</td>
      <td>16.257</td>
    </tr>
    <tr>
      <td>R<sup>2</sup></td>
      <td>0.741</td>
      <td>0.807</td>
    </tr>
  </tbody>
</table>

<p>The results show a definite increase in overall error reduction as well as more variance explained by the quantile regression. Additionally, if you look at the plot below, you can see that the blue points (simple OLS model) tend to have larger errors around the upper and lower points of the target variable, which is consistent with our expectations.</p>

<p><img src="/images/quantile_comparison.png" alt="" /></p>

<p>This is all great, but how is this interpretable if we have 19 individual models fit, each with their own sets of coefficients with intercepts, slopes and confidence intervals? One easy way would be to plot the values for each covariate independently as a function of the quantile on which they were trained to see how the relationships vary in terms of the response variable. Below is a quick example comparing the simple OLS model slopes vs each of the covariates’ quantile regression results:</p>

<p><img src="/images/quantile_slope_values.png" alt="" /></p>

<p>If you take a look at the <a href="https://github.com/mwburke/mwburke.github.io/tree/master/scripts/quantile_regression.py">file used to create these plots/calculations</a>, you can look at how I have done these calculations and probably augment the charts to include upper/lower bounds as well as intercept values to get an even fuller picture of how your models are functioning, to the point where you could explain to management, your mom, unwilling friends, etc…</p>

<h1 id="summary">Summary</h1>

<p>Although quantile regression doesn’t move past the basic linear approaches of OLS, it does allow some flexibility and can be a good compromise being stuck with the most basic techniques and being able to eek out a little extra accuracy for your models without sacrificing interpretability.</p>

<h2 id="extra-note">Extra Note</h2>

<p>If you aren’t constrained to linear modeling but still would prefer a powerful model with high interpretability, I’d highly recommend checking out <a href="https://en.wikipedia.org/wiki/Generalized_additive_model">generalized additive models</a>, which supports non-linear modeling of linear predictors while easily displaying relationships between variables and allowing many customizations such as monotonic constraints and smoothing parameters. Stitch Fix has a <a href="https://multithreaded.stitchfix.com/blog/2015/07/30/gam/">fantastic article</a> on it, and there’s a convenient <a href="https://github.com/dswah/pyGAM">python library</a> you might find helpful as well in getting up and running quickly.</p>

<h2 id="additional-resources">Additional Resources</h2>

<p><a href="https://www.oreilly.com/learning/introduction-to-local-interpretable-model-agnostic-explanations-lime">Introduction to local Interpretable Model-agnostic Explanations (O’Reilly)</a></p>

<p><a href="https://arxiv.org/pdf/1602.04938.pdf">“Why Should I Trust You?” Explaining the Predictions of Any Classifier</a></p>

<p><a href="https://christophm.github.io/interpretable-ml-book/">Interpretable Machine Learning: A Guide for Making Black Box Models Explainable</a></p>

<p><a href="https://data.library.virginia.edu/getting-started-with-quantile-regression/">Getting Started With Quantile Regression</a></p>

        </div>

        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/generative%20art/2018/07/09/generative-art-p5js.html">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> My Intro to Generative Art

      </span>
    </a>
  

  
    <a class="page-next" href="/data%20science/2018/11/26/probability-calibration.html">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Probability Calibration
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="social-icons"><a class="social-icon" href="https://twitter.com/yot_club"><i class="fab fa-twitter-square fa-2x" title="Twitter"></i></a><a class="social-icon" href="https://instagram.com/yot_club_"><i class="fab fa-instagram fa-2x" title="Instagram"></i></a><a class="social-icon" href="https://github.com/mwburke"><i class="fab fa-github-square fa-2x" title="GitHub"></i></a><a class="social-icon" href="/atom.xml"><i class="fas fa-rss-square fa-2x" title="Feed"></i></a></div><div class="copyright">
    
      <p>&copy; 2021 Matthew's Blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </body>

</html>
